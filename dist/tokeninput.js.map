{"version":3,"sources":["../src/tokeninput.js"],"names":["bindingHandlers","tokeninputSource","init","element","valueAccessor","allBindings","params","bindings","$selectedElement","value","tokeninputValue","observable","toggleSelection","tokeninputToggleSelection","tokeninputOptions","tokeninputUpdating","tokeninputDestroying","reinit","sub","getOptions","theme","onResult","onAdd","onDelete","preventDuplicates","minChars","caching","searchDelay","animateDropdown","allowTabOut","noResultsText","searchingText","disabled","unwrap","tokeninputDisable","prePopulate","filter","includes","result","id","tokenInputOptions","console","error","results","added","removeAll","tokenInput","push","deleted","remove","onTokenDelete","apply","arguments","subscribe","onChange","utils","domNodeDisposal","addDisposeCallback","dispose","update","data","local_data","isObservable","length","resetModified","isModified","valueHasMutated","isDisabled","tokeninputTokens","tokens","lastTokens","slice","newTokens","compareArrays","forEach","difference","status"],"mappings":"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","file":"tokeninput.js","sourcesContent":["import { merge } from 'scalejs';\r\nimport $ from 'jquery';\r\nimport ko from 'knockout';\r\nimport _ from 'lodash';\r\nimport 'ep-jquery-tokeninput';\r\nimport 'ep-jquery-tokeninput/styles/token-input.css';\r\n\r\nko.bindingHandlers.tokeninputSource = {\r\n    init: function (\r\n        element,\r\n        valueAccessor,\r\n        allBindings\r\n    ) {\r\n        const params = valueAccessor(),\r\n            bindings = allBindings(),\r\n            $selectedElement = $(element),\r\n            value = bindings.tokeninputValue || ko.observable(),\r\n            toggleSelection = bindings.tokeninputToggleSelection;\r\n        let tokeninputOptions = bindings.tokeninputOptions || {},\r\n            tokeninputUpdating = false, //prevent update on programatic update\r\n            tokeninputDestroying = false, //prevent update on re-init or destroy\r\n            reinit = false, // prevent update on re-init\r\n            sub = null;\r\n\r\n        function getOptions() {\r\n            return merge({\r\n                theme: 'pjson',\r\n                onResult: onResult,\r\n                onAdd: onAdd,\r\n                onDelete: onDelete,\r\n                preventDuplicates: true,\r\n                minChars: 0,\r\n                caching: false,\r\n                searchDelay: 0,\r\n                animateDropdown: false,\r\n                allowTabOut: true,\r\n                noResultsText: null,\r\n                searchingText: null,\r\n                disabled: ko.unwrap(bindings.tokeninputDisable),\r\n                prePopulate: valueAccessor().filter(result => (value() || []).includes(result.id))\r\n            }, tokeninputOptions);\r\n        }\r\n\r\n        if (bindings.tokenInputOptions) {\r\n            console.error('tokenInputOptions is depricated, please use tokeninputOptions');\r\n            tokeninputOptions = bindings.tokenInputOptions;\r\n        }\r\n\r\n        function onResult(results) {\r\n            // console.log('Results -->', results);\r\n            return results.filter(result => !value().includes(result.id));\r\n        }\r\n\r\n        function onAdd(added) {\r\n            // console.log('Add -->', added);\r\n            tokeninputUpdating = true;\r\n            if (added.id === toggleSelection) {\r\n                value.removeAll();\r\n                $selectedElement.tokenInput(\"clear\");\r\n            } else if (value().includes(toggleSelection)) {\r\n                value.removeAll([toggleSelection]);\r\n                $selectedElement.tokenInput(\"remove\", {id: toggleSelection});\r\n            }\r\n            value.push(added.id);\r\n            tokeninputUpdating = false;\r\n        }\r\n\r\n        function onDelete(deleted) {\r\n            // console.log('Delete -->', deleted);\r\n            if (reinit || tokeninputDestroying) {\r\n                return;\r\n            }\r\n            tokeninputUpdating = true;\r\n            value.remove(deleted.id);\r\n            tokeninputUpdating = false;\r\n            if (tokeninputOptions.onTokenDelete) {\r\n                tokeninputOptions.onTokenDelete.apply(this, arguments);\r\n            }\r\n        }\r\n\r\n        function init() {\r\n            $selectedElement.tokenInput(params, getOptions());\r\n        }\r\n\r\n        init();\r\n\r\n        sub = value.subscribe(() => {\r\n            if (!tokeninputUpdating) {\r\n                reinit = true;\r\n                $selectedElement.tokenInput('destroy');\r\n                init();\r\n                reinit = false;\r\n            } else if (!tokeninputDestroying) {\r\n                if (tokeninputOptions.onChange) {\r\n                    tokeninputOptions.onChange();\r\n                }\r\n            }\r\n        });\r\n\r\n        // if (options.placeholder) {\r\n        //     $selectedElement.parent().find('input').attr('placeholder', options.placeholder);\r\n        // }\r\n\r\n        ko.utils.domNodeDisposal.addDisposeCallback(element, () => {\r\n            tokeninputDestroying = true;\r\n            $selectedElement.tokenInput('destroy');\r\n            tokeninputDestroying = false;\r\n            sub.dispose();\r\n        });\r\n    },\r\n    update: function (\r\n        element,\r\n        valueAccessor,\r\n        allBindings\r\n    ) {\r\n        const params = valueAccessor(),\r\n            value = allBindings().tokeninputValue;\r\n        // console.log('new params-->', params);\r\n        $(element).data('settings').local_data = params;\r\n\r\n        if (ko.isObservable(value) && value().length > 0) {\r\n            let resetModified = false;\r\n            if (value.isModified && !value.isModified()) {\r\n                resetModified = true;\r\n            }\r\n            value.valueHasMutated();\r\n            if (resetModified) {\r\n                value.isModified(false);\r\n            }\r\n            // redudancy because local_data is set after initialization\r\n            // but if there was some initial values, we want to redo prepoulate logic\r\n            // so we need to reset local_data as again after initialization we want to make sure it is set\r\n            $(element).data('settings').local_data = params;\r\n        }\r\n    }\r\n};\r\n\r\nko.bindingHandlers.tokeninputDisable = {\r\n    update: function (\r\n        element,\r\n        valueAccessor\r\n    ) {\r\n        const isDisabled = ko.unwrap(valueAccessor());\r\n\r\n        $(element).tokenInput('toggleDisabled', ko.unwrap(isDisabled) || false);\r\n    }\r\n};\r\n\r\nko.bindingHandlers.tokeninputTokens = {\r\n    init: function (\r\n        element,\r\n        valueAccessor\r\n    ) {\r\n        const tokens = valueAccessor();\r\n        let lastTokens = tokens().slice(),\r\n            sub = null;\r\n\r\n        sub = tokens.subscribe((newTokens) => {\r\n            ko.utils.compareArrays(lastTokens, newTokens)\r\n                .forEach((difference) => {\r\n                    if (difference.status === 'added') {\r\n                        $(element).tokenInput('add', difference.value);\r\n                    }\r\n                    if (difference.status === 'deleted') {\r\n                        $(element).tokenInput('remove', difference.value);\r\n                    }\r\n                });\r\n            lastTokens = newTokens.slice();\r\n        });\r\n\r\n        ko.utils.domNodeDisposal.addDisposeCallback(element, () => {\r\n            sub.dispose();\r\n        });\r\n    }\r\n};\r\n\r\nko.bindingHandlers.tokeninputOptions = {};\r\n\r\nko.bindingHandlers.tokeninputValue = {};"]}