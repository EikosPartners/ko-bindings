{"version":3,"sources":["../src/profileImage.js"],"names":[],"mappings":"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","file":"profileImage.js","sourcesContent":["/*global define */\r\nimport core from 'scalejs.core';\r\nimport ko from 'knockout';\r\nimport $ from 'jquery';\r\n\r\n/**\r\n * TODO - description\r\n * @module profileImage\r\n */\r\n\r\n    var token,\r\n        defaultUrl = '/gmep/images/default-profile-photo.png',\r\n        get = core.object.get;\r\n\r\n    function getToken(callback) {\r\n        $.ajax({\r\n           type: 'GET',\r\n           url:'/rest/api/resourceIndex',\r\n           success: function(data, textStatus, request){\r\n             token = request.getResponseHeader('X-Oracle-RF-Token');\r\n             callback();\r\n           },\r\n           error: function (request, textStatus, errorThrown) {\r\n            console.error('Error to get Token: '+errorThrown);\r\n            callback();\r\n           }\r\n        });\r\n    }\r\n\r\n    ko.bindingHandlers.profileImage = {\r\n        init: function (\r\n            element,\r\n            valueAccessor,\r\n            allBindingsAccessor\r\n        ) {\r\n            var userId = valueAccessor(),\r\n                imageSrc = ko.observable({}),\r\n                size = allBindingsAccessor().size || 'small',\r\n                nameOnRight = allBindingsAccessor().nameOnRight || false;\r\n\r\n            function setProfileImage() {\r\n               // at this point, if there is no user id or no token\r\n               // then we should just show a default image.\r\n               if(!userId || !token) {\r\n                   imageSrc({\r\n                    imageUrl: defaultUrl,\r\n                    size: size\r\n                   });\r\n                   return;\r\n               }\r\n\r\n                $.ajax({\r\n                   url: '/rest/api/gmep/share/profile/' + userId + '?utoken=' + token,\r\n                   success: function (data) {\r\n                    var json = xmlToJson(data),\r\n                        imageUrl = get(json, 'profileResponse.imageURL.#text'),\r\n                        initialName = get(json, 'profileResponse.initialName.#text'),\r\n                        displayName = get(json, 'profileResponse.displayName.#text');\r\n\r\n                    if (imageUrl) {\r\n                       imageUrl = '/webcenter' + imageUrl;\r\n                    } else if (!initialName) {\r\n                        imageUrl = defaultUrl;\r\n                    }\r\n\r\n                    imageSrc({\r\n                        initialName: initialName,\r\n                        imageUrl: imageUrl,\r\n                        displayName: displayName,\r\n                        size: size,\r\n                        nameOnRight: nameOnRight\r\n                    });\r\n\r\n                   },\r\n                   error: function () {\r\n                       imageSrc({\r\n                        imageUrl: defaultUrl,\r\n                        size: size\r\n                       });\r\n                   }\r\n                });\r\n            }\r\n\r\n            ko.applyBindingsToNode(element, { template: { name: 'profile_picture_template', data: imageSrc } });\r\n\r\n            // if the token already exists, can just get images\r\n            if(token) {\r\n                setProfileImage();\r\n            } else {\r\n            // otherwise, first get the token then set the profile iamge.\r\n                getToken(setProfileImage);\r\n            }\r\n\r\n            return { controlsDescendantBindings: true };\r\n        }\r\n    };\r\n\r\n    //No pesky logs!\r\n    ko.bindingHandlers.size = ko.bindingHandlers.size || {};\r\n    ko.bindingHandlers.nameOnRight = ko.bindingHandlers.nameOnRight || {};\r\n\r\n    function xmlToJson(xml) {\r\n      // Create the return object\r\n      var obj = {};\r\n\r\n      if (xml.nodeType == 1) { // element\r\n          // do attributes\r\n          if (xml.attributes.length > 0) {\r\n          obj[\"@attributes\"] = {};\r\n              for (var j = 0; j < xml.attributes.length; j++) {\r\n                  var attribute = xml.attributes.item(j);\r\n                  obj[\"@attributes\"][attribute.nodeName] = attribute.nodeValue;\r\n              }\r\n          }\r\n      } else if (xml.nodeType == 3) { // text\r\n          obj = xml.nodeValue;\r\n      }\r\n\r\n      // do children\r\n      if (xml.hasChildNodes()) {\r\n          for(var i = 0; i < xml.childNodes.length; i++) {\r\n              var item = xml.childNodes.item(i);\r\n              var nodeName = item.nodeName;\r\n              if (typeof(obj[nodeName]) == \"undefined\") {\r\n                  obj[nodeName] = xmlToJson(item);\r\n              } else {\r\n                  if (typeof(obj[nodeName].push) == \"undefined\") {\r\n                      var old = obj[nodeName];\r\n                      obj[nodeName] = [];\r\n                      obj[nodeName].push(old);\r\n                  }\r\n                  obj[nodeName].push(xmlToJson(item));\r\n              }\r\n          }\r\n      }\r\n      return obj;\r\n    }\r\n"]}