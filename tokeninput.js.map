{"version":3,"sources":["../src/tokeninput.js"],"names":["bindingHandlers","tokeninputSource","init","element","valueAccessor","allBindings","params","bindings","$selectedElement","value","tokeninputValue","observable","tokeninputUpdating","reinit","getOptions","theme","onResult","onAdd","onDelete","preventDuplicates","minChars","caching","searchDelay","animateDropdown","allowTabOut","noResultsText","searchingText","disabled","unwrap","tokeninputDisable","prePopulate","filter","includes","result","id","tokenInputOptions","results","added","push","deleted","remove","tokenInput","subscribe","utils","domNodeDisposal","addDisposeCallback","update","data","local_data","isDisabled","tokeninputOptions"],"mappings":"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","file":"tokeninput.js","sourcesContent":["import { merge } from 'scalejs';\r\nimport $ from 'jquery';\r\nimport ko from 'knockout';\r\nimport _ from 'lodash';\r\nimport 'ep-jquery-tokeninput';\r\nimport 'ep-jquery-tokeninput/styles/token-input.css';\r\n\r\nko.bindingHandlers.tokeninputSource = {\r\n    init: function (\r\n        element,\r\n        valueAccessor,\r\n        allBindings\r\n    ) {\r\n        const params = valueAccessor(),\r\n            bindings = allBindings(),\r\n            $selectedElement = $(element),\r\n            value = bindings.tokeninputValue || ko.observable();\r\n        let tokeninputUpdating = false,\r\n            reinit = false;\r\n\r\n        function getOptions() {\r\n            return merge({\r\n                theme: 'pjson',\r\n                onResult: onResult,\r\n                onAdd: onAdd,\r\n                onDelete: onDelete,\r\n                preventDuplicates: true,\r\n                minChars: 0,\r\n                caching: false,\r\n                searchDelay: 0,\r\n                animateDropdown: false,\r\n                allowTabOut: true,\r\n                noResultsText: null,\r\n                searchingText: null,\r\n                disabled: ko.unwrap(bindings.tokeninputDisable),\r\n                prePopulate: params.filter(result => (value() || []).includes(result.id))\r\n            }, bindings.tokenInputOptions);\r\n        }\r\n\r\n        function onResult(results) {\r\n            // console.log('Results -->', results);\r\n            return results.filter(result => !value().includes(result.id));\r\n        }\r\n\r\n        function onAdd(added) {\r\n            // console.log('Add -->', added);\r\n            tokeninputUpdating = true;\r\n            value.push(added.id);\r\n            tokeninputUpdating = false;\r\n        }\r\n\r\n        function onDelete(deleted) {\r\n            // console.log('Delete -->', deleted);\r\n            if (reinit) {\r\n                return;\r\n            }\r\n            tokeninputUpdating = true;\r\n            value.remove(deleted.id);\r\n            tokeninputUpdating = false;\r\n        }\r\n\r\n        function init() {\r\n            $selectedElement.tokenInput(params, getOptions());\r\n        }\r\n\r\n        init();\r\n\r\n        value.subscribe(() => {\r\n            if (!tokeninputUpdating) {\r\n                reinit = true;\r\n                $selectedElement.tokenInput('destroy');\r\n                init();\r\n                reinit = false;\r\n            }\r\n        });\r\n\r\n        // if (options.placeholder) {\r\n        //     $selectedElement.parent().find('input').attr('placeholder', options.placeholder);\r\n        // }\r\n\r\n        ko.utils.domNodeDisposal.addDisposeCallback(element, () => {\r\n            $selectedElement.tokenInput('destroy');\r\n        });\r\n    },\r\n    update: function (\r\n        element,\r\n        valueAccessor\r\n    ) {\r\n        const params = valueAccessor();\r\n        // console.log('new params-->', params);\r\n        $(element).data('settings').local_data = params;\r\n    }\r\n};\r\n\r\nko.bindingHandlers.tokeninputDisable = {\r\n    update: function (\r\n        element,\r\n        valueAccessor\r\n    ) {\r\n        const isDisabled = valueAccessor();\r\n\r\n        $(element).tokenInput('toggleDisabled', ko.unwrap(isDisabled));\r\n    }\r\n};\r\n\r\nko.bindingHandlers.tokeninputOptions = {};\r\n\r\nko.bindingHandlers.tokeninputValue = {};"]}