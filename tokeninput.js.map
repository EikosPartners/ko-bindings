{"version":3,"sources":["../src/tokeninput.js"],"names":["bindingHandlers","tokeninputSource","init","element","valueAccessor","allBindings","params","bindings","$selectedElement","value","tokeninputValue","observable","tokeninputUpdating","reinit","getOptions","theme","onResult","onAdd","onDelete","preventDuplicates","minChars","caching","searchDelay","animateDropdown","allowTabOut","noResultsText","searchingText","disabled","unwrap","tokeninputDisable","prePopulate","filter","includes","result","id","tokenInputOptions","results","added","push","deleted","remove","tokenInput","subscribe","utils","domNodeDisposal","addDisposeCallback","update","data","local_data","isDisabled","tokeninputOptions"],"mappings":"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","file":"tokeninput.js","sourcesContent":["import { merge } from 'scalejs';\nimport $ from 'jquery';\nimport ko from 'knockout';\nimport _ from 'lodash';\nimport 'jquery-tokeninput';\nimport 'jquery-tokeninput/styles/token-input.css';\n\nko.bindingHandlers.tokeninputSource = {\n    init: function (\n        element,\n        valueAccessor,\n        allBindings\n    ) {\n        const params = valueAccessor(),\n            bindings = allBindings(),\n            $selectedElement = $(element),\n            value = bindings.tokeninputValue || ko.observable();\n        let tokeninputUpdating = false,\n            reinit = false;\n\n        function getOptions() {\n            return merge({\n                theme: 'pjson',\n                onResult: onResult,\n                onAdd: onAdd,\n                onDelete: onDelete,\n                preventDuplicates: true,\n                minChars: 0,\n                caching: false,\n                searchDelay: 0,\n                animateDropdown: false,\n                allowTabOut: true,\n                noResultsText: null,\n                searchingText: null,\n                disabled: ko.unwrap(bindings.tokeninputDisable),\n                prePopulate: params.filter(result => (value() || []).includes(result.id))\n            }, bindings.tokenInputOptions);\n        }\n\n        function onResult(results) {\n            // console.log('Results -->', results);\n            return results.filter(result => !value().includes(result.id));\n        }\n\n        function onAdd(added) {\n            // console.log('Add -->', added);\n            tokeninputUpdating = true;\n            value.push(added.id);\n            tokeninputUpdating = false;\n        }\n\n        function onDelete(deleted) {\n            // console.log('Delete -->', deleted);\n            if (reinit) {\n                return;\n            }\n            tokeninputUpdating = true;\n            value.remove(deleted.id);\n            tokeninputUpdating = false;\n        }\n\n        function init() {\n            $selectedElement.tokenInput(params, getOptions());\n        }\n\n        init();\n\n        value.subscribe(() => {\n            if (!tokeninputUpdating) {\n                reinit = true;\n                $selectedElement.tokenInput('destroy');\n                init();\n                reinit = false;\n            }\n        });\n\n        // if (options.placeholder) {\n        //     $selectedElement.parent().find('input').attr('placeholder', options.placeholder);\n        // }\n\n        ko.utils.domNodeDisposal.addDisposeCallback(element, () => {\n            $selectedElement.tokenInput('destroy');\n        });\n    },\n    update: function (\n        element,\n        valueAccessor\n    ) {\n        const params = valueAccessor();\n        // console.log('new params-->', params);\n        $(element).data('settings').local_data = params;\n    }\n};\n\nko.bindingHandlers.tokeninputDisable = {\n    update: function (\n        element,\n        valueAccessor\n    ) {\n        const isDisabled = valueAccessor();\n\n        $(element).tokenInput('toggleDisabled', ko.unwrap(isDisabled));\n    }\n};\n\nko.bindingHandlers.tokeninputOptions = {};\n\nko.bindingHandlers.tokeninputValue = {};"]}